\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{fixmetodonote}

\RequirePackage{graphicx}
\RequirePackage{color}
\RequirePackage{transparent}
\RequirePackage{watermark}
\RequirePackage{fix-cm}
\RequirePackage[normalem]{ulem}
\RequirePackage[titles]{tocloft}

\newcommand{\listnotesname}{List of notes}
\newlistof{note}{notes}{\listnotesname}

\newcommand{\@HUGE}{\fontsize{100}{120}\selectfont}
\newcommand{\@wmstyle}{\color{red}\transparent{0.1}\@HUGE}
\newcommand{\@wmtext}{\textsc{DRAFT}}

\newcommand{\@DRAFTwatermark}{%
  \thiswatermark{%
    \raisebox{-0.5\textheight}{%
      \parbox{\linewidth}{%
          \centering{\rotatebox{30}{\@wmstyle\@wmtext}%
          }%
      }%
    }%
  }%
}

\newcommand{\NOTES@marker}[2]{\fbox{\color{#2}\textbf{#1}}}
\newcommand{\NOTES@marginmarker}[2]{\marginpar{\NOTES@marker{#1}{#2}}}
\newcommand{\NOTES@inlinemarker}[2]{\NOTES@marker{#1}{#2}}

\newcommand{\NOTES@usemarker}[2]{\csname NOTES@#1marker\endcsname{#2}{red}}

\newcommand{\NOTES@addtolist}[2]{%
  \refstepcounter{note}%
  \phantomsection%
  \addcontentsline{notes}{note}{\protect\numberline{\thenote}{{#1}: {#2}}}%
}

\newcommand{\defnote}[3]{%
  \global\expandafter\newcommand\csname #1\endcsname[1]{%
    \NOTES@usemarker{#2}{#1}%
    #3{##1}%
    \NOTES@addtolist{#1}{##1}%
    \@DRAFTwatermark%
  }%
}

\defnote{FIXME}{margin}{\uwave}
\defnote{TODO}{inline}{\colorbox{yellow}}
\defnote{CITE}{inline}{\colorbox{cyan}}
